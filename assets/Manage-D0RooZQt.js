import{_ as x,i as S,j as v,s as f,o as c,c as u,a as t,n as h,k as d,F as k,g as F,d as U,t as b,l as R,r as _,f as y,v as w,m as C,b as p,w as D,h as $}from"./index-Cju7tG9q.js";const E={name:"upload",props:["addSong"],data(){return{is_dragover:!1,uploads:[]}},methods:{upload(s){this.is_dragover=!1,(s.dataTransfer?[...s.dataTransfer.files]:[...s.target.files]).forEach(a=>{if(a.type!=="audio/mpeg")return;if(!navigator.onLine){this.uploads.push({task:{},current_progress:100,name:a.name,varient:"bg-red-400",icon:"fas fa-times",text_class:"text-red-400"});return}const r=S.ref().child(`songs/${a.name}`).put(a),o=this.uploads.push({task:r,current_progress:0,name:a.name,varient:"bg-blue-400",icon:"fas fa-spinner fa-spin",text_class:""})-1;r.on("state_changed",i=>{const g=i.bytesTransferred/i.totalBytes*100;this.uploads[o].current_progress=g},i=>{this.uploads[o].varient="bg-red-400",this.uploads[o].icon="fas fa-times",this.uploads[o].text_class="text-red-400",console.log(i)},async()=>{const i={uid:v.currentUser.uid,display_name:v.currentUser.displayName,original_name:r.snapshot.ref.name,modified_name:r.snapshot.ref.name,genre:"",comment_count:0};i.url=await r.snapshot.ref.getDownloadURL();const l=await(await f.add(i)).get();this.addSong(l),this.uploads[o].varient="bg-green-400",this.uploads[o].icon="fas fa-check",this.uploads[o].text_class="text-green-400"})})},cancelUploads(){this.uploads.forEach(s=>{s.task.cancel()})}},beforeUnmount(){this.uploads.forEach(s=>{s.task.cancel()})}},I={class:"col-span-1"},q={class:"bg-white rounded border border-gray-200 relative flex flex-col"},B=t("div",{class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},[t("span",{class:"card-title"},"Upload"),t("i",{class:"fas fa-upload float-right text-green-400 text-2xl"})],-1),N={class:"p-6"},T=t("h5",null,"Drop your files here",-1),L=[T],M=t("hr",{class:"my-6"},null,-1),V={class:"flex h-4 overflow-hidden bg-gray-200 rounded"};function G(s,e,a,m,n,r){return c(),u("div",I,[t("div",q,[B,t("div",N,[t("div",{class:h(["w-full px-10 py-20 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-500 hover:text-white hover:bg-green-400 hover:border-green-400 hover:border-solid",{"bg-green-400 border-green-400 border-solid":n.is_dragover}]),onDrag:e[0]||(e[0]=d(()=>{},["prevent","stop"])),onDragstart:e[1]||(e[1]=d(()=>{},["prevent","stop"])),onDragend:e[2]||(e[2]=d(o=>n.is_dragover=!1,["prevent","stop"])),onDragover:e[3]||(e[3]=d(o=>n.is_dragover=!0,["prevent","stop"])),onDragenter:e[4]||(e[4]=d(o=>n.is_dragover=!0,["prevent","stop"])),onDragleave:e[5]||(e[5]=d(o=>n.is_dragover=!1,["prevent","stop"])),onDrop:e[6]||(e[6]=d(o=>r.upload(o),["prevent","stop"]))},L,34),t("input",{type:"file",multiple:"",onChange:e[7]||(e[7]=o=>r.upload(o))},null,32),M,(c(!0),u(k,null,F(n.uploads,o=>(c(),u("div",{class:"mb-4",key:o.name},[t("div",{class:h(["font-bold text-sm",o.text_class])},[t("i",{class:h(o.icon)},null,2),U(b(o.name),1)],2),t("div",V,[t("div",{class:h(["transition-all progress-bar",o.varient]),style:R({width:`${o.current_progress}%`})},null,6)])]))),128))])])])}const P=x(E,[["render",G]]),j={name:"CompositionItem",props:{song:{type:Object,required:!0},updateSong:{type:Function,required:!0},index:{type:Number,required:!0},removeSong:{type:Function,required:!0},updateUnsavedFlag:{type:Function,required:!1}},data(){return{showForm:!1,schema:{modified_name:"required",genre:"alpha_spaces"},in_submittion:!1,show_alert:!1,alert_varient:"bg-blue-500",alert_message:"Please wait! Updating song info."}},methods:{async edit(s){this.in_submittion=!0,this.show_alert=!0,this.alert_varient="bg-blue-500",this.alert_message="Please wait! Updating song info.";try{await f.doc(this.song.docId).update(s)}catch{this.in_submittion=!1,this.alert_varient="bg-red-500",this.alert_message="Something went wrong! Please try later.";return}this.in_submittion=!1,this.alert_varient="bg-green-500",this.alert_message="Success",this.updateSong(this.index,s),this.updateUnsavedFlag(!1)},async deleteSong(){await S.ref().child(`songs/${this.song.original_name}`).delete(),await f.doc(this.song.docId).delete(),this.removeSong(this.index)}}},z={class:"border border-gray-200 p-3 mb-4 rounded"},A={class:"inline-block text-2xl font-bold"},O=t("i",{class:"fa fa-times"},null,-1),Y=[O],H=t("i",{class:"fa fa-pencil-alt"},null,-1),J=[H],K={class:"mb-3"},Q=t("label",{class:"inline-block mb-2"},"Song Title",-1),W={class:"mb-3"},X=t("label",{class:"inline-block mb-2"},"Genre",-1),Z=["disabled"],ee=["disabled"];function te(s,e,a,m,n,r){const o=_("vee-field"),i=_("ErrorMessage"),g=_("vee-form");return c(),u("div",z,[y(t("div",null,[t("h4",A,b(a.song.modified_name),1),t("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-red-600 float-right",onClick:e[0]||(e[0]=d((...l)=>r.deleteSong&&r.deleteSong(...l),["prevent"]))},Y),t("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-blue-600 float-right",onClick:e[1]||(e[1]=d(l=>n.showForm=!n.showForm,["prevent"]))},J)],512),[[w,!n.showForm]]),y(t("div",null,[n.show_alert?(c(),u("div",{key:0,class:h([n.alert_varient,"text-white text-center font-bold p-4 mb-4"])},b(n.alert_message),3)):C("",!0),p(g,{"validation-schema":n.schema,"initial-values":a.song,onSubmit:r.edit},{default:D(()=>[t("div",K,[Q,p(o,{name:"modified_name",type:"text",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Song Title",onInput:e[2]||(e[2]=l=>a.updateUnsavedFlag(!0))}),p(i,{class:"text-red-600",name:"modified_name"})]),t("div",W,[X,p(o,{type:"text",name:"genre",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Genre",onInput:e[3]||(e[3]=l=>a.updateUnsavedFlag(!0))}),p(i,{class:"text-red-600",name:"genre"})]),t("button",{type:"submit",disabled:n.in_submittion,class:"py-1.5 px-3 rounded text-white bg-green-600"}," Submit ",8,Z),t("button",{type:"button",disabled:n.in_submittion,onClick:e[4]||(e[4]=d(l=>n.showForm=!1,["prevent"])),class:"py-1.5 px-3 rounded text-white bg-gray-600"}," Go Back ",8,ee)]),_:1},8,["validation-schema","initial-values","onSubmit"])],512),[[w,n.showForm]])])}const se=x(j,[["render",te]]),oe={name:"manage",components:{AppUpload:P,CompositionItem:se},data(){return{songs:[],unsavedFlag:!1}},async created(){(await f.where("uid","==",v.currentUser.uid).get()).forEach(this.addSong)},methods:{updateSong(s,e){this.songs[s].modified_name=e.modified_name,this.songs[s].genre=e.genre},removeSong(s){this.songs.splice(s,1)},addSong(s){const e={...s.data(),docId:s.id};this.songs.unshift(e)},updateUnsavedFlag(s){this.unsavedFlag=s}},beforeRouteLeave(s,e,a){if(!this.unsavedFlag){a();return}const m=confirm("You have unsaved changes, are you sure you want to leave?");a(m)}},ne={class:"container mx-auto mt-6"},re={class:"md:grid md:grid-cols-3 md:gap-4"},ae={class:"col-span-2"},ie={class:"bg-white rounded border border-gray-200 relative flex flex-col"},de={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},le={class:"card-title"},ce=t("i",{class:"fa fa-compact-disc float-right text-green-400 text-2xl"},null,-1),ge={class:"p-6"};function ue(s,e,a,m,n,r){const o=_("app-upload"),i=_("composition-item");return c(),u("section",ne,[t("div",re,[p(o,{addSong:r.addSong},null,8,["addSong"]),t("div",ae,[t("div",ie,[t("div",de,[t("span",le,b(s.$t("manage.mySongs")),1),ce]),t("div",ge,[(c(!0),u(k,null,F(n.songs,(g,l)=>(c(),$(i,{song:g,key:g.id,updateSong:r.updateSong,index:l,removeSong:r.removeSong,updateUnsavedFlag:r.updateUnsavedFlag},null,8,["song","updateSong","index","removeSong","updateUnsavedFlag"]))),128))])])])])])}const me=x(oe,[["render",ue]]);export{me as default};
